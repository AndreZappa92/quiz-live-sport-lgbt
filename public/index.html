<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pride House Quiz - CIG Arcigay Milano</title>
    <!-- Tailwind CSS per lo styling rapido e moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel per far girare il codice JSX direttamente nel browser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <!-- Firebase SDK v8 (Compatibilità garantita) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-gray-50 overflow-x-hidden select-none font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, Fragment } = React;

        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                trophy: <g><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6V3h12v1h1.5a2.5 2.5 0 0 1 0 5H18v3c0 4.42-3.58 8-8 8H8a8 8 0 0 1-2-15.74V9z"/><path d="M12 18a6 6 0 0 0 6-6V4H6v8a6 6 0 0 0 6 6z"/></g>,
                users: <g><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></g>,
                play: <path d="m7 4 12 8-12 8V4z" fill="currentColor"/>,
                chevronRight: <path d="m9 18 6-6-6-6"/>,
                checkCircle: <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14M22 4L12 14.01l-3-3"/>,
                xCircle: <g><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6m0-6 6 6"/></g>,
                crown: <path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7z" fill="currentColor"/>,
                clock: <g><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></g>,
                zap: <path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z" fill="currentColor"/>,
                coins: <g><circle cx="8" cy="8" r="6"/><circle cx="16" cy="16" r="6"/></g>,
                smile: <g><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/></g>,
                qr: <g><rect width="5" height="5" x="3" y="3" rx="1"/><rect width="5" height="5" x="16" y="3" rx="1"/><rect width="5" height="5" x="3" y="16" rx="1"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21h.01"/><path d="M16 21h.01"/><path d="M21 16h.01"/><path d="M16 16h.01"/></g>,
                loader2: <g><path d="M21 12a9 9 0 1 1-6.219-8.56"/></g>
            };
            return (
                <svg viewBox="0 0 24 24" width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        const LogoArcigay = ({ className }) => (
            <img src="/logoCIG.png" alt="Logo CIG" className={className} onError={(e) => {
                e.target.onerror = null; 
                e.target.src = "https://www.arcigaymilano.org/wp-content/themes/arcigay-milano/assets/images/logo.png";
            }} />
        );

        const firebaseConfig = {
            apiKey: "AIzaSyDOWS0ZMGxhj6ATL6FFycR-DATvuYug3WM",
            authDomain: "quiz-live-sport-lgbt.firebaseapp.com",
            projectId: "quiz-live-sport-lgbt",
            storageBucket: "quiz-live-sport-lgbt.firebasestorage.app",
            messagingSenderId: "741735100972",
            appId: "1:741735100972:web:6040adbb5b040257931789",
            measurementId: "G-47N6SFEWZG"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'quiz-lgbt-sport-2026';
        const TIMER_SECONDS = 30;

        const QUIZ_DATA = {
            "title": "Sport e Inclusione: LGBT+",
            "questions": [
                {
                    question: "In quale città e in quale anno si sono tenuti i primi Gay Games?",
                    answerOptions: [
                        { text: "San Francisco, 1982", rationale: "Fondati da Tom Waddell per promuovere l'inclusione.", isCorrect: true },
                        { text: "New York, 1969", rationale: "Anno dei moti di Stonewall, ma i giochi arrivarono dopo.", isCorrect: false },
                        { text: "Amsterdam, 1998", rationale: "Sede storica, ma non il debutto.", isCorrect: false },
                        { text: "Londra, 1975", rationale: "Pionieri in molti campi, ma non i primi giochi.", isCorrect: false }
                    ]
                },
                {
                    question: "Chi è stato il primo calciatore professionista in attività a fare coming out nel 1990?",
                    answerOptions: [
                        { text: "Justin Fashanu", rationale: "Pioniere assoluto nel calcio inglese.", isCorrect: true },
                        { text: "Thomas Hitzlsperger", rationale: "Lo ha fatto solo dopo il ritiro.", isCorrect: false },
                        { text: "Jakub Jankto", rationale: "Lo ha fatto in attività, ma nel 2023.", isCorrect: false },
                        { text: "Robbie Rogers", rationale: "Lo ha fatto nel 2013.", isCorrect: false }
                    ]
                },
                {
                    question: "L'atleta Laurel Hubbard ha segnato la storia di Tokyo 2020 per quale motivo?",
                    answerOptions: [
                        { text: "Prima donna transgender in gara individuale", rationale: "Ha aperto un dibattito globale sull'inclusività.", isCorrect: true },
                        { text: "Prima medaglia d'oro non binaria", rationale: "Non ha raggiunto il podio in quell'edizione.", isCorrect: false },
                        { text: "Portabandiera dei rifugiati", rationale: "Ruolo ricoperto da altri atleti.", isCorrect: false },
                        { text: "Record mondiale atletica", rationale: "Gareggiava nel sollevamento pesi.", isCorrect: false }
                    ]
                },
                {
                    question: "Quale icona del tennis ha vinto 18 titoli Slam e vive apertamente la propria omosessualità?",
                    answerOptions: [
                        { text: "Martina Navratilova", rationale: "Una delle più grandi attiviste LGBT+ nello sport.", isCorrect: true },
                        { text: "Billie Jean King", rationale: "Icona immensa, ma il coming out pubblico avvenne dopo la Navratilova.", isCorrect: false },
                        { text: "Chris Evert", rationale: "Storica rivale, ma non appartenente alla comunità.", isCorrect: false },
                        { text: "Steffi Graf", rationale: "Dominatrice anni '90, non legata all'attivismo LGBT+.", isCorrect: false }
                    ]
                },
                {
                    question: "La calciatrice Megan Rapinoe quale premio ha vinto nel 2019?",
                    answerOptions: [
                        { text: "Pallone d'Oro femminile", rationale: "Simbolo globale di lotta per l'uguaglianza.", isCorrect: true },
                        { text: "Premio Oscar", rationale: "È un'atleta, non ha vinto premi cinematografici.", isCorrect: false },
                        { text: "Oro nel Nuoto", rationale: "È esclusivamente una calciatrice.", isCorrect: false },
                        { text: "Sindaco di Seattle", rationale: "Non ricopre cariche politiche.", isCorrect: false }
                    ]
                },
                {
                    "question": "Durante i Mondiali di calcio in Qatar 2022, quale simbolo è stato al centro di una disputa?",
                    "answerOptions": [
                        { "text": "La fascia da capitano 'OneLove'", "rationale": "La FIFA proibì l'uso dell'arcobaleno sotto sanzioni.", "isCorrect": true },
                        { "text": "Scarpe glitterate", "rationale": "Nessuna polemica sulle calzature.", "isCorrect": false },
                        { "text": "Fumogeni colorati", "rationale": "Vietati per sicurezza generale.", "isCorrect": false },
                        { "text": "Cambio nome torneo", "rationale": "Il nome è rimasto invariato.", "isCorrect": false }
                    ]
                },
                {
                    "question": "Chi è il tuffatore britannico oro a Tokyo 2020 celebre per l'uncinetto?",
                    "answerOptions": [
                        { "text": "Tom Daley", "rationale": "Icona di visibilità e impegno sociale.", "isCorrect": true },
                        { "text": "Matthew Mitcham", "rationale": "Campione australiano, non britannico.", "isCorrect": false },
                        { "text": "Greg Louganis", "rationale": "Leggenda degli anni '80.", "isCorrect": false },
                        { "text": "Ian Thorpe", "rationale": "È un nuotatore.", "isCorrect": false }
                    ]
                },
                {
                    "question": "Qual è lo scopo principale degli EuroGames?",
                    "answerOptions": [
                        { "text": "Inclusione e lotta alla discriminazione", "rationale": "Evento aperto a tutti i livelli e orientamenti.", "isCorrect": true },
                        { "text": "Qualificazioni Olimpiadi", "rationale": "Non è un evento di qualifica ufficiale.", "isCorrect": false },
                        { "text": "Vincere premi in denaro", "rationale": "Lo spirito è sociale e comunitario.", "isCorrect": false },
                        { "text": "Solo per professionisti", "rationale": "Aperto a ogni livello di abilità.", "isCorrect": false }
                    ]
                },
                {
                    "question": "Cosa fece Gus Kenworthy in TV a Pyeongchang 2018?",
                    "answerOptions": [
                        { "text": "Un bacio in diretta al compagno", "rationale": "Momento storico di visibilità globale.", "isCorrect": true },
                        { "text": "Gareggiò in tutù", "rationale": "Gareggiò in divisa ufficiale.", "isCorrect": false },
                        { "text": "Rifiutò la medaglia", "rationale": "La accettò con orgoglio.", "isCorrect": false },
                        { "text": "Portò un randagio sul podio", "rationale": "Li salva, ma non sul podio.", "isCorrect": false }
                    ]
                },
                {
                    "question": "Cosa sono i 'Rainbow Laces'?",
                    "answerOptions": [
                        { "text": "Campagna per l'inclusione nello sport", "rationale": "Nata nel Regno Unito per mostrare solidarietà.", "isCorrect": true },
                        { "text": "Standard scarpe corsa", "rationale": "Nessun obbligo tecnico arcobaleno.", "isCorrect": false },
                        { "text": "Simbolo 10 medaglie", "rationale": "I lacci sono simboli di solidarietà.", "isCorrect": false },
                        { "text": "Decorazione natalizia", "rationale": "Usati tutto l'anno per sensibilizzare.", "isCorrect": false }
                    ]
                }
            ]
        };

        const COLORS = ['bg-[#e30613]', 'bg-[#0054a6]', 'bg-[#009640]', 'bg-[#ffde00]'];

        function App() {
            const [user, setUser] = useState(null);
            const [role, setRole] = useState(() => sessionStorage.getItem('activeRole'));
            const [roomCode, setRoomCode] = useState(() => sessionStorage.getItem('activeRoom') || '');
            const [playerName, setName] = useState(() => sessionStorage.getItem('activePlayerName') || '');
            const [gameState, setGameState] = useState(null);
            const [players, setPlayers] = useState([]);
            const [hasAnswered, setHasAnswered] = useState(false);
            const [lastAnswerCorrect, setLastAnswerCorrect] = useState(null);
            const [lastPointsEarned, setLastPointsEarned] = useState(0);
            const [errorMessage, setErrorMessage] = useState('');
            const [loadingAction, setLoadingAction] = useState(false);
            const [timeLeft, setTimeLeft] = useState(TIMER_SECONDS);

            const getQrUrl = () => {
                const joinUrl = `${window.location.origin}${window.location.pathname}?room=${roomCode}`;
                return `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(joinUrl)}&bgcolor=ffffff&color=0054a6&margin=10`;
            };

            useEffect(() => {
                const unsub = auth.onAuthStateChanged(async (u) => {
                    if (!u) {
                        try { await auth.signInAnonymously(); } catch (e) { setErrorMessage("Connessione Firebase fallita."); }
                    } else {
                        setUser(u);
                        if (roomCode && !playerName) {
                            try {
                                const snap = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('players').doc(`${roomCode}_${u.uid}`).get();
                                if (snap.exists) {
                                    const d = snap.data();
                                    setRole('player');
                                    setName(d.name);
                                    sessionStorage.setItem('activeRole', 'player');
                                    sessionStorage.setItem('activePlayerName', d.name);
                                }
                            } catch (e) { console.error("Restore error:", e); }
                        }
                    }
                });
                return () => unsub();
            }, [roomCode, playerName]);

            useEffect(() => {
                if (!user || !roomCode || !role) return;
                const code = roomCode.trim().toUpperCase();
                
                const unsubRoom = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(code).onSnapshot(s => {
                    if (s.exists) { setGameState(s.data()); } 
                    else { if (role === 'player') setErrorMessage("Stanza non trovata."); }
                }, err => setErrorMessage("Errore DB: Verifica le regole di sicurezza."));

                const unsubPlayers = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('players').onSnapshot(snap => {
                    const all = snap.docs.map(d => d.data()).filter(p => p.roomCode === code).sort((a,b) => b.score - a.score);
                    setPlayers(all);
                });

                return () => { unsubRoom(); unsubPlayers(); };
            }, [user, roomCode, role]);

            useEffect(() => {
                if (gameState?.status === 'playing' && !gameState.showResults && gameState.questionStartTime) {
                    const timer = setInterval(() => {
                        const elapsed = Math.floor((Date.now() - gameState.questionStartTime) / 1000);
                        const remaining = Math.max(0, TIMER_SECONDS - elapsed);
                        setTimeLeft(remaining);
                        if (remaining === 0) clearInterval(timer);
                    }, 500);
                    return () => clearInterval(timer);
                }
            }, [gameState]);

            useEffect(() => {
                if (gameState && !gameState.showResults) {
                    setHasAnswered(false);
                    setLastAnswerCorrect(null);
                    setLastPointsEarned(0);
                    setTimeLeft(TIMER_SECONDS);
                }
            }, [gameState?.currentQuestionIndex, gameState?.showResults]);

            const createRoom = async () => {
                if (!user) return;
                setLoadingAction(true);
                try {
                    const code = Math.random().toString(36).substring(2,6).toUpperCase();
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(code).set({
                        code, status: 'lobby', currentQuestionIndex: 0, showResults: false, hostId: user.uid, createdAt: Date.now(), questionStartTime: 0
                    });
                    sessionStorage.setItem('activeRoom', code);
                    sessionStorage.setItem('activeRole', 'host');
                    setRoomCode(code);
                    setRole('host');
                } catch (e) { setErrorMessage("Errore creazione stanza."); }
                setLoadingAction(false);
            };

            const joinRoom = async () => {
                const cleanName = playerName.trim();
                const cleanCode = roomCode.trim().toUpperCase();
                if (!cleanName || !cleanCode) return;
                setLoadingAction(true);
                try {
                    const room = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(cleanCode).get();
                    if (room.exists) {
                        await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('players').doc(`${cleanCode}_${user.uid}`).set({
                            uid: user.uid, name: cleanName, roomCode: cleanCode, score: 0, lastAnswerIndex: -1, lastQuestionIndexAnswered: -1, lastAnsweredAt: 0
                        });
                        sessionStorage.setItem('activeRoom', cleanCode);
                        sessionStorage.setItem('activeRole', 'player');
                        sessionStorage.setItem('activePlayerName', cleanName);
                        setRole('player');
                    } else setErrorMessage("Codice errato.");
                } catch (e) { setErrorMessage("Errore rete."); }
                setLoadingAction(false);
            };

            const submitAnswer = async (i) => {
                if (hasAnswered || !gameState || gameState.showResults) return;
                const isCorrect = QUIZ_DATA.questions[gameState.currentQuestionIndex].answerOptions[i].isCorrect;
                const earned = isCorrect ? 1000 : 0;
                setHasAnswered(true);
                setLastAnswerCorrect(isCorrect);
                setLastPointsEarned(earned);
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('players').doc(`${roomCode}_${user.uid}`).update({
                    score: firebase.firestore.FieldValue.increment(earned),
                    lastAnswerIndex: i, lastQuestionIndexAnswered: gameState.currentQuestionIndex, lastAnsweredAt: Date.now()
                });
            };

            if (!role) return (
                <div className="min-h-screen flex items-center justify-center bg-gray-50 p-6 font-black">
                    <div className="bg-white p-10 rounded-3xl shadow-xl border w-full max-w-md text-center">
                        <LogoArcigay className="h-20 mx-auto mb-6" />
                        <h1 className="text-2xl text-[#0054a6] uppercase mb-8">Pride House Quiz</h1>
                        {errorMessage && <p className="text-red-500 mb-4 text-xs">{errorMessage}</p>}
                        <div className="space-y-4">
                            <input type="text" placeholder="Nome Squadra" className="w-full border p-4 rounded-xl text-center" value={playerName} onChange={e => setName(e.target.value)} />
                            <input type="text" placeholder="Codice" className="w-full border p-4 rounded-xl text-center uppercase" value={roomCode} onChange={e => setRoomCode(e.target.value)} />
                            <button onClick={joinRoom} className="w-full bg-[#0054a6] text-white p-4 rounded-xl uppercase">Partecipa</button>
                            <button onClick={createRoom} className="w-full text-[#0054a6] border-2 border-[#0054a6] p-2 rounded-xl text-sm uppercase">Crea Stanza Host</button>
                        </div>
                    </div>
                </div>
            );

            if (role === 'host' && gameState) {
                const q = QUIZ_DATA.questions[gameState.currentQuestionIndex];
                return (
                    <div className="h-screen flex flex-col bg-gray-50 font-black p-4 overflow-hidden">
                        <header className="flex justify-between items-center bg-white p-4 rounded-xl shadow mb-4">
                            <LogoArcigay className="h-10" />
                            <div className="flex items-center gap-4">
                                <div className="text-gray-400 uppercase text-xs">Codice: <span className="text-[#0054a6] font-mono font-bold text-lg">{roomCode}</span></div>
                                <div className="bg-[#0054a6] text-white px-4 py-2 rounded-full flex gap-2">
                                    <Icon name="users" size={18}/><span>{players.length}</span>
                                </div>
                            </div>
                        </header>
                        
                        <div className="flex-1 flex gap-6 overflow-hidden">
                            <div className="flex-1 flex flex-col items-center justify-center text-center bg-white rounded-3xl border shadow-inner p-8 overflow-y-auto custom-scrollbar">
                                {gameState.status === 'lobby' ? (
                                    <div className="space-y-10 animate-fade-in">
                                        <div className="space-y-2">
                                            <h2 className="text-6xl text-[#0054a6] uppercase tracking-tighter">In attesa dei giocatori...</h2>
                                            <p className="text-gray-400 text-xl font-medium">Inquadra il QR Code per partecipare al quiz!</p>
                                        </div>
                                        <div className="bg-white p-8 rounded-[3rem] border-4 border-[#0054a6]/10 shadow-2xl inline-block mx-auto">
                                            <img src={getQrUrl()} alt="Join QR Code" className="w-80 h-80 rounded-2xl" />
                                            <div className="mt-4 flex items-center justify-center gap-2 text-[#0054a6]">
                                                <Icon name="qr" size={24} />
                                                <span className="text-2xl font-black uppercase">Scansiona e Gioca</span>
                                            </div>
                                        </div>
                                        <div className="pt-4">
                                            <button onClick={() => db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomCode).update({status:'playing', questionStartTime: Date.now()})} className="bg-[#0054a6] text-white px-16 py-6 rounded-[2rem] text-4xl uppercase shadow-xl hover:scale-105 transition-transform active:scale-95 disabled:opacity-50" disabled={players.length === 0}>
                                                Inizia il Quiz
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="w-full max-w-4xl space-y-12 animate-fade-in">
                                        <div className="space-y-2">
                                            <p className="text-[#0054a6] uppercase text-sm tracking-widest">Domanda {gameState.currentQuestionIndex + 1} di 10</p>
                                            <h2 className="text-5xl text-[#0054a6] leading-tight">{q.question}</h2>
                                        </div>
                                        <div className="grid grid-cols-2 gap-6">
                                            {q.answerOptions.map((o, i) => (
                                                <div key={i} className={`p-8 rounded-[2rem] border-4 text-2xl flex items-center gap-4 transition-all ${gameState.showResults ? (o.isCorrect ? 'border-green-500 bg-green-50 text-green-700 shadow-lg scale-105' : 'border-gray-100 opacity-40 grayscale text-gray-400') : 'border-gray-100 bg-gray-50 text-[#0054a6]'}`}>
                                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-white shrink-0 ${COLORS[i]}`}>{String.fromCharCode(65+i)}</div>
                                                    <span className="font-bold">{o.text}</span>
                                                    {gameState.showResults && o.isCorrect && <Icon name="checkCircle" size={32} className="ml-auto" />}
                                                </div>
                                            ))}
                                        </div>
                                        {gameState.showResults && (
                                            <div className="p-6 bg-blue-50 rounded-2xl border border-blue-100 text-[#0054a6] text-xl animate-fade-in">
                                                <p className="font-bold uppercase text-xs opacity-60 mb-2">Perché questa risposta?</p>
                                                {q.answerOptions.find(opt => opt.isCorrect).rationale}
                                            </div>
                                        )}
                                        <button onClick={() => {
                                            if (gameState.showResults) {
                                                if (gameState.currentQuestionIndex === 9) db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomCode).update({status:'finished'});
                                                else db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomCode).update({currentQuestionIndex: firebase.firestore.FieldValue.increment(1), showResults: false, questionStartTime: Date.now()});
                                            } else db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomCode).update({showResults:true});
                                        }} className="bg-[#0054a6] text-white px-12 py-5 rounded-3xl text-2xl uppercase shadow-xl hover:scale-105 transition-all">
                                            {gameState.showResults ? "Prossima Domanda" : "Rivela Risposta"}
                                        </button>
                                    </div>
                                )}
                            </div>

                            {/* Sidebar Informativa */}
                            <div className="w-64 flex flex-col gap-4">
                                <div className="bg-white p-4 rounded-3xl border shadow-sm flex flex-col items-center gap-3">
                                    <img src={getQrUrl()} alt="Join QR" className="w-full rounded-xl border" />
                                    <p className="text-[10px] text-gray-400 uppercase font-black text-center tracking-widest">Aggiungiti in tempo reale</p>
                                </div>
                                <div className="bg-white p-6 rounded-3xl border shadow-sm flex-1 overflow-hidden flex flex-col">
                                    <h3 className="text-xs text-gray-400 uppercase mb-4 border-b pb-2 tracking-widest">Classifica Live</h3>
                                    <div className="flex-1 overflow-y-auto custom-scrollbar space-y-3">
                                        {players.map((p, i) => (
                                            <div key={p.uid} className={`flex justify-between items-center p-2 rounded-lg ${i < 3 ? 'bg-blue-50 text-[#0054a6]' : 'text-gray-500'}`}>
                                                <span className="truncate max-w-[100px] text-sm">{i+1}. {p.name}</span>
                                                <span className="font-mono font-bold">{p.score}</span>
                                            </div>
                                        ))}
                                        {players.length === 0 && <p className="text-center text-gray-300 italic text-xs py-4">In attesa...</p>}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {gameState.status === 'finished' && (
                            <div className="fixed inset-0 bg-white/95 backdrop-blur-sm z-50 flex flex-col items-center justify-center p-10 animate-fade-in">
                                <Icon name="crown" size={120} className="text-[#ffde00] mb-6 animate-bounce" />
                                <h2 className="text-8xl text-[#0054a6] mb-16 uppercase italic">Podio Finale</h2>
                                <div className="flex items-end gap-10 w-full max-w-5xl h-80">
                                    {players[1] && <div className="flex-1 flex flex-col items-center"><p className="text-2xl mb-2 text-[#0054a6] font-bold">{players[1].name}</p><div className="w-full bg-gray-200 h-40 rounded-t-3xl flex items-center justify-center text-7xl text-gray-400 shadow-xl border-t-8 border-gray-300 font-bold">2</div></div>}
                                    {players[0] && <div className="flex-1 flex flex-col items-center"><p className="text-4xl mb-4 text-[#0054a6] font-black drop-shadow-md">{players[0].name}</p><div className="w-full bg-gradient-to-b from-[#ffde00] to-[#e6c800] h-64 rounded-t-[3rem] flex items-center justify-center text-[10rem] text-[#0054a6] shadow-2xl border-t-8 border-[#ffde00] font-black">1</div></div>}
                                    {players[2] && <div className="flex-1 flex flex-col items-center"><p className="text-2xl mb-2 text-[#0054a6] font-bold">{players[2].name}</p><div className="w-full bg-orange-100 h-32 rounded-t-3xl flex items-center justify-center text-7xl text-orange-300 shadow-xl border-t-8 border-orange-200 font-bold">3</div></div>}
                                </div>
                                <button onClick={() => { sessionStorage.clear(); window.location.reload(); }} className="mt-20 bg-gray-900 text-white px-20 py-6 rounded-full text-2xl uppercase tracking-widest hover:bg-black transition-all">Nuova Partita</button>
                            </div>
                        )}
                    </div>
                );
            }

            if (role === 'player' && gameState) return (
                <div className="min-h-screen bg-white flex flex-col font-black items-center justify-center p-6 text-center">
                    <header className="fixed top-0 w-full p-4 border-b-4 border-[#ffde00] flex justify-between bg-white z-10">
                        <LogoArcigay className="h-10" />
                        <div className="bg-[#0054a6] text-white px-4 py-1 rounded-full text-lg font-mono">
                            {players.find(p=>p.uid===user?.uid)?.score || 0}
                        </div>
                    </header>
                    {gameState.status === 'playing' && !gameState.showResults ? (
                        <div className="grid grid-cols-1 gap-4 w-full max-w-sm animate-fade-in mt-16">
                            <div className="flex items-center justify-center gap-2 mb-4">
                                <Icon name="clock" size={24} className={timeLeft < 10 ? "text-red-500 animate-pulse" : "text-[#0054a6]"} />
                                <span className={`text-5xl font-mono ${timeLeft < 10 ? "text-red-500" : "text-[#0054a6]"}`}>{timeLeft}s</span>
                            </div>
                            {hasAnswered ? (
                                <div className="space-y-6 py-20 bg-gray-50 rounded-[3rem] border-4 border-dashed border-[#0054a6]/20 animate-pulse">
                                    <Icon name="loader2" size={64} className="animate-spin mx-auto text-[#0054a6]/40" />
                                    <h2 className="text-3xl uppercase text-[#0054a6]/60">Risposta Ricevuta</h2>
                                    <p className="text-gray-400 text-sm px-10">Controlla lo schermo principale per il risultato!</p>
                                </div>
                            ) : (
                                <div className="grid grid-cols-1 gap-4 h-[60vh]">
                                    {COLORS.map((c, i) => (
                                        <button key={i} onClick={() => submitAnswer(i)} className={`p-8 rounded-[2.5rem] ${c} text-white text-7xl shadow-xl active:translate-y-2 active:shadow-none transition-all border-b-8 border-black/20`}>
                                            {String.fromCharCode(65+i)}
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                    ) : (
                        <div className="space-y-8 animate-fade-in">
                            <Icon name="loader2" size={80} className="animate-spin mx-auto text-[#0054a6]/20" />
                            <h2 className="text-3xl uppercase text-[#0054a6] tracking-tighter">In attesa dell'host...</h2>
                            <p className="text-gray-400 max-w-[200px] mx-auto text-sm">Resta concentrato, il quiz sta per iniziare!</p>
                        </div>
                    )}
                </div>
            );

            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>